\documentclass[class=scrbook, crop=false]{standalone}
\usepackage[subpreambles=true]{standalone}
\ifstandalone
    \input{../settings+/settings}
\fi

% ----------------------------------------------------------------------------
%                               Theoretical Background
% ----------------------------------------------------------------------------
\begin{document}

\ifstandalone
    \selectlanguage{ngerman}  % Toggle ON/OFF

    % Language-specific settings that change automatically
    \input{settings+/language}
\fi

\chapter{Theoretical Background}
\label{Chapter::Theoretical_Background} % Outline text
This chapter provides background knowledge to understand the concepts in the thesis.

% Background topics that are necessary to understand your thesis
\section{German electricity market}
\label{Section::German_Electricity_Market}

In the german electricity market every market participant is a BRP. Each BRP has to balance their portfolio so that their generation matches their consumption. Both of these values are partially unknown and can deviate. 
Energy generation can have many sources, for VRE the produced energy heavily depends on the current weather.
To estimate the energy generated by VRE information about weather situations can be used to get an approximation. 

As well as the generation, consumption of energy also is not fixed. The consumption of energy varies with social constructs, such as the work week, holidays or school holidays. 
BRPs have access to past data to make an informed decision and submit a schedule when they will insert how much energy into the system.
This schedule is submitted to the TSOs.

The physically delivered volumes might differ from these schedules, for example due to a bad weather forecast. In this case the BRP has an imbalanced portfolio.
The deviation in all portfolios of all BRPs in a balancing area are summed up and the result is the system balance (SB) for that balancing area. Summed up across all balancing areas this is the grid control network system balance.

To keep the grid at 50hz frequency, TSOs have to dispatch balancing energy according to the system balance. This energy can be positive, if the grid is short of energy, or negative, if the grid has a surplus of energy. 

If the system is in need of energy reserve generators that run below full capacity can be activated to increase their production. Another way of introducing positive balancing energy into the grid is turning off variable loads to decrease energy consumption.

If the system has a surplus of energy, negative balancing energy has to be dispatched. This can be done either by throttleing capacity generators which are running above minimum capacity. Negative balancing energy can also be inserted into the grid by turning on variable loads, leading to an increased energy consumption.

Now every BRPs portfolio is balanced using this balancing energy. For this the imbalance price is calculated. How this price is calculated will be explained in the next chapter.
Each BRP whose portfolio led to increasing the system balance, for example having provided not enough energy whilst the system is also short of energy, has to pay the imbalance price for the volume of their imbalance. 
On the other hand, BRPs which helped stabilize the system with their portfolio, for example providing more energy than consumed while the system is short of energy, are remunerated for their imbalance. 

Next, the different auctions and their schedule will be explained. An overview can be found in \ref{fig::energy_auctions}. 

\begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/energy_auctions.png}
            \caption[Timeschedule for energy market auctions]{Timeschedule for energy market auctions \cite{narajewskiProbabilisticForecastingGerman2022}.}
            \label{fig::energy_auctions}
 \end{figure}
 
 On the far right of the figure the time of delivery is shown, denoted by $d$, $h$ of the delivery. The auctions for this timestamp start the day before. From $8:00$ to $10:00$ on the previous day reserve capacity auctions take place. These auctions decide how positive and negative balancing energy is introduced into the system when balancing the grid. During this auctions will not play any role, as data for these auctions was not available at the time of the experiments. 
The first auction takes place at $12:00$ one day before delivey and is called the day ahead (DA) auction. At $15:00$ the next auction, the intraday auction (IA) takes place. After that, at $16:00$ intraday continuous trading (IC) starts. Whilst the auctions are a single auction event, during the intraday continuous (IC) trading window energy can be traded at any time. The IC has different closing times. Up until $30$ minutes before delivery energy can be traded across all control zones. Trades on IC that happen within a single control zone can be done up until $5$ minutes before delivery.

\section{Imbalance price}
\label{Section::Imbalance_Price}
The calculation of the imbalance price is split up into three modules, which are calculated seperately and subsequently aggregated.

\subsection{Module 1: Basis component}
The first module is called the basis component. 
This module represents the cost of providing the balancing energy.

With information provided by PICASSO the volume-weighted average price for the automatic frequency restoration reserve $VWAP_{aFRR}$ can be calculated. This is calculated for both positive and negative activations, resulting in $VWAP_{aFRR, GCC, pos, qh}$ and $VWAP_{aFRR,  GCC, neg, qh}$ for each quarter hour $qh$ and the GCC balance.
The same calculations are done for mFRR activations using data from MARI, resulting int $VWAP_{mFRR, GCC, pos, qh}$ and $VWAP_{mFRR, GCC, neg, qh}$. 
These valuese are used in the formulas \ref{fig::aep1_pos} and \ref{fig::aep1_neg} to calculate the values $AEP1_{pos}$ and $AEP1_{neg}$. 
If neither aFRR or mFRR were activated during the associated quarter hour this $AEP1$ takes the value of avoided activation. This value is equal to the mean of the cheapest aFRR bid prices for the quarter hour.
If only one of the reserves was activated $AEP1$ takes the value of the $VWAP$ of that reserve. 
If both reserves were activated, the $AEP1$ is equal to the volume-weighted average of both $VWAPs$. The volume is denoted by the satisfied demand $SD$.

\begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/aep1_pos.png}
            \caption[Positive AEP 1 component formula]{Positive AEP 1 component formula \cite{NetztransparenzReBAP}.}
            \label{fig::aep1_pos}
 \end{figure}
 
 

 \begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/aep1_neg.png}
             \caption[Positive AEP 1 component formula]{Positive AEP 1 component formula \cite{NetztransparenzReBAP}.}
            \label{fig::aep1_neg}
 \end{figure}

With both $AEP1s$, the value of the basis component can be calculated. If the system balance is positive, this module takes the value of $AEP1_{GCC, pos, qh}$. If the system balance is negative, this module takes the value of $AEP1_{GCC, neg, qh}$. If the system balance is equal to 0, this module's value is 0.

\subsection{Module 2: Incentivising component}
\label{Section::Module_2}
The goal behind module 2 is to increase the reBAP, so that it is more costly to use imbalance energy than buying the need energy on the intraday market. This should incentivise all BRPs to keep their portfolio balanced. 
The formula for its calculation is displayed in figure \ref{fig::aep2}.and will be explained in the next paragraphs.

For each settlement period $V_{ID}$ denotes the volume of total trades that were closed on the intraday market for this quarter. If this volume is below $500$MW, this component finds no application and takes the value of 0. If value was greater than $500$MW this module is calculated using the Intraday Price Index (ID AEP) and a minimum distance $\Delta P$. 
The ID AEP is calculated for each quarter hour by averaging over the trades closest to the delivery time. For this calculation only a volume of 500 MW, so 125 MW/h for a quarter hour is considered.  
The volume-weighted average price is formed from the transactions filtered this way. 
In the case that the GCC balance is equal to 0, this module takes the value of ID AEP.  In the case of a positive GCC balance, a minimum distance $\Delta P$ is added onto the ID AEP, in case of a negative GCC balance this $\Delta P$ is substracted from the ID AEP. Between ID AEP and module 2 a minimum distance of $25\%$, but at least 10€ is established, assuming the absolute value of the GCC balance is equal to or greater than $500$ MW. This distance $\Delta P$ linearly ramps up from $0$MW to $500$MW. The formula for $\Delta P$ can be found in figure \ref{fig::delta_p} and a graph for its values with a fixed ID AEP of $100€/MWh$ is displayed in figure \ref{fig::delta_p_graph}.

 \begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/aep_2.png}
             \caption[Formula for $AEP_{Module 2}$]{Formula for $AEP_{Module 2}$ \cite{NetztransparenzReBAP}.}
            \label{fig::aep2}
 \end{figure}

 \begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/delta_p.png}
             \caption[Formula for$ \Delta P$]{Formula for $\Delta P$ \cite{NetztransparenzReBAP}.}
            \label{fig::delta_p}
 \end{figure}
 
 \begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/delta_p_graph.png}
             \caption[Graph for $\Delta P$ with a fixed ID AEP for $100€/MWh$ \cite{NetztransparenzReBAP}]{Graph for $\Delta P$ with a fixed ID AEP for $100€/MWh$ \cite{NetztransparenzReBAP}.}
            \label{fig::delta_p_graph}
 \end{figure}

\subsection{Module 3: Scarcity component}

If the GCC balance exceeds $80\%$ of the frequency restoration reserve (FRR) for a settlement period, the scarcity component is applied. This component rarely is the price setting module of the reBAP (<1\%). The formula for this module will not be discussed here. Figure \ref{fig::aep_3} shows a graph of how this module's value changes relatively to the GCC balance.


 \begin{figure}[ht]
            \centering
            \includegraphics[width=\textwidth]{theory/aep_3.png}
             \caption[Graph how the price of module 3 correlates with GCC balance$ \cite{NetztransparenzReBAP}]{Graph how the price of module 3 correlates with GCC balance \cite{NetztransparenzReBAP}.}
            \label{fig::aep_3}
 \end{figure}


Depeding on the sign of the GCC balance, either the minimum or the maximum of the three modules introduced in the previous paragraphs is used. The formula for this is displayed in figure \ref{fig::rebap_neg}. If the GCC balance is positive, the module with the highest value is used. If the balance is negative the cheapest module is used to determine the reBAP.

For the whole year 2024 the reBAP was equal to the basis component $82.76\%$, equal to the incentivising component $17.23\%$ and equal to the scarcity component $0.00\%$ of the time, with the scarcity component only being the price setting module once throughout 2024. This data is displayed in figure \ref{fig::aep_modules}.

 \begin{figure}[ht]
            \centering
            \includegraphics[width=.5\textwidth]{theory/aep_modules.png}
             \caption[How often each module was price-setting in 2024?]{How often each module was price-setting in 2024?}
            \label{fig::aep_modules}
 \end{figure}



% You can use this to add content for standalone documents if you like
% In this case we would like to show the references.
\ifstandalone
    % Bibliography
    \printbibliography[heading=bibintoc]                         \cleardoublepage

% ----------------------------------------------------------------------------
% Appendix and Glossary
% ----------------------------------------------------------------------------
%     \pagenumbering{Alph} % A, B, C..

% %     % Appendix
%     \input{chapters/appendix}                                          \clearpage

% %     % Symbol list also counts as a glossary object
%     \printglossary[type=main]  % main glossary

% %     % Either print all entries or only used entries for all lists
%     \glsaddallunused
\fi

\end{document}
