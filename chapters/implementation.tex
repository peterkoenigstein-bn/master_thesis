\documentclass[class=scrbook, crop=false]{standalone}
\usepackage[subpreambles=true]{standalone}
\ifstandalone
    \input{../settings+/settings}
\fi
\usepackage[table]{xcolor}% http://ctan.org/pkg/xcolor

% ----------------------------------------------------------------------------
%                               Implementation
% ----------------------------------------------------------------------------
\begin{document}

\chapter{Implementation} % Outline text
\label{Chapter::Implementation}
    This chapter contains a description of how the implemented algorithm works.

% First explain concepts you used in your thesis like filters or methods
% Then explain your approach or algorithm
% Use flowcharts to give an overview
\section{Feature engineering}
\label{Section::Feature_engineering}

The data introduced in section \ref{Chapter::Methodology} can be further refined to gain additional information. 
The following sections contain information about how the data was used to create more features.
Feature engineering was done for energy data, weather data and holiday data.

    \subsection{Energy data}
    \label{Section::Energy_Data}
    The energy data provided by ENTSO-E can be further refined to gain additional information.
    One additional feature is the residual load. 
    Residual load is defined as the load that is not covered by VRE. 
    This is calulated by subtracting the generation provided by solar, wind onshore and win offshore from the load.
    
    Another way of generating more informative features is to calculate the forecasting error. 
    For this the forecast for solar generation, wind generation and load is substracted from the actual measured values.
    This can also be done for the residual load.
    For each of these variables the correlation with the imbalance price is calclulated to estimate how much influence the variables have in determining the imbalance price.
    Table \ref{Table::Rebap_Correlations_ENTSOE} contains the results for these calculations. 
    
    Out of these features the forecasted and actual value for residual load, the forecasting error for solar generation have the largest absolute correlation.
    It should be noted that the actual values are not available at prediction time.    

    \begin{table}
    \begin{tabular}{l|l|l|l}
    Variable Name &Forecasted Value& Actual Value& Forecasting Error \\\hline
    Solar &-0,053& -0,064& \cellcolor{green} \textbf{-0,116} \\
    Wind offshore & -0,077&-0,075& \cellcolor{green} 0,000 \\
    Wind onshore &-0,101&-0,107& \cellcolor{green} -0,047 \\
    Load &0,070&0,056& \cellcolor{green} -0,037 \\
    Residual Load & \cellcolor{green} \textbf{0,169}& \cellcolor{green} \textbf{0,171}& \cellcolor{green}0,025\\
    \end{tabular}
    
    \caption{Correlations between variables and imbalance price (rounded to next $10^{-3}$). Green cells are new features}
    \label{Table::Rebap_Correlations_ENTSOE}
    \end{table}
    
    The newly introduced features in this section will also be used for inspecting possible features introduced at a later point.
    
    \subsection{Weather data}
    \label{Section::Weather_data}
    The weather data contains a lot of datapoints, especially the MOSMIX forecast. 
    For each of the originally 40 features a forecast is done 240 times for each timestep. 
    This data needs to be condensed, as not all of theses timestamps are useful.
    There are certain timestamps which will be inspected closer for the feature engineering.
    
    The forecasts done by ENTSO-E are published the day before and use the weather forecast from that time.
    The forecast happens at 18:00. 
    In the MOSMIX data this timestamp will be more closely looked at for this reason.
    Another important timestamp is the latest timestamp. 
    With a forecast being done each hour, the latest available timestamp at prediction time is the one 2 hours before gate closure time, due to the prediction happening at 1 hour before gate closure time.
    For each of the variables introduced in \ref{Table::DWD_MOSMIX_Parameters_Small} the correlation for both of the previously discussed timestamps is checked.
    The results for the correlation can be found in table \ref{Table::DWD_MOSMIX_correlations}. 
    
    With both of these configurations for each of the variables a new feature can be created. 
    To get an estimate for the forecasting error in the ENTSO-E data, the change in forecast can be calculated in the DWD data.
    Under the assumption, that a more recent forecast is more accurate, the difference between the latest forecast and the forecast of the day before at $18:00$ is calculated. 
    
    Dividing the most recent forecast by the day ahead forecast would maybe provide a more meaningful relation, but due to the nature of the data this is problematic.
    The dataset contains variables with large value ranges, including 0. 
    By dividing, this new feature might take extreme values.
    On the other hand some variables have scales which make the division less meaningful.
    For example the temperature is measured in kelvin, leading to small quotients.

    

\end{document}
